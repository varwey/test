{% extends "layout/layout.html" %}

{% block content %}
    {{ macros.setting_nav('members', group.id) }}

    {% macro _render_members(group_role, members) %}
        <ul class="list-group">
            {% for m in members %}
                <li class="list-group-item">
                    <img src="{{ m.sized_avatar_url(20) }}" alt=""/>
                    <a href="{{ url_for('personal.index', user_id=m.id) }}">{{ m.nickname }}</a>
                    <div class="list-group-item-meta">
                        {% if m.id != current_user.id  %}
                            {% if group_role == 1 %}
                                <a href="{{ url_for('group.remove_manager', group_id=group.id, user_id=m.id) }}">取消管理员资格</a>
                            {% elif group_role == 2 %}
                                <a href="{{ url_for('group.add_manager', group_id=group.id, user_id=m.id) }}">晋升为管理员</a>
                            {% endif %}
                        {% endif %}
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% endmacro %}

    {% for group_role, members in members|groupby('group_role')  %}
        {% if group_role == 0 %}
            {% call macros.render_panel_content(h2_title='创建者', use_list=True) %}
                {{ _render_members(group_role, members) }}
            {% endcall %}
        {% elif group_role == 1 %}
            {% call macros.render_panel_content(h2_title='管理员', use_list=True) %}
                {{ _render_members(group_role, members) }}
            {% endcall %}
        {% else %}
            {% call macros.render_panel_content(h2_title='成员', use_list=True) %}
                {{ _render_members(group_role, members) }}
            {% endcall %}
        {% endif %}
    {% endfor %}
{% endblock %}

{% block sidebar %}
    <a class="bottom-gap btn-primary btn" href="{{ url_for('group.group_home', group_id=group.id) }}">回到：{{ group.group_name }}</a>
{% endblock %}

